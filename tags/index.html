<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Evil Monkey Labs</title>
  
  <link href="http://blog.evilmonkeylabs.com" rel="alternate" title="Evil Monkey Labs" type="application/atom+xml" />
  <link rel="openid.delegate" href="http://evilmonkeylabs.myopenid.com" />

  <link rel="stylesheet" href="/stylesheets/application.css" type="text/css" />
  <link rel="stylesheet" href="/stylesheets/evilmonkey.css" type="text/css" />
</head>

<body>
<div id="container">
  <div id="logo">
    <img src="/images/logo_small.png" alt="Evil Monkey Logo"/>
  </div>
  <div id="header">
    <h1><span><a href="/">Evil Monkey Labs</a></span></h1>
    <h2>Code and related ramblings.</h2>
  </div>

  <div id="page">
    <div id="content">
      <h1>Tags</h1>

  
  
  <a id="tech" href="#tech"><h2>tech</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="IronPython" href="#IronPython"><h2>IronPython</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="Silverlight" href="#Silverlight"><h2>Silverlight</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="Python" href="#Python"><h2>Python</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="ActiveDirectory" href="#ActiveDirectory"><h2>ActiveDirectory</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="LDAP" href="#LDAP"><h2>LDAP</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="mongodb" href="#mongodb"><h2>mongodb</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="scala" href="#scala"><h2>scala</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="casbah" href="#casbah"><h2>casbah</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="mapreduce" href="#mapreduce"><h2>mapreduce</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="java" href="#java"><h2>java</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="typeclasses" href="#typeclasses"><h2>typeclasses</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="stupidpettricks" href="#stupidpettricks"><h2>stupidpettricks</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="effectivescala" href="#effectivescala"><h2>effectivescala</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="bestpractices" href="#bestpractices"><h2>bestpractices</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="python" href="#python"><h2>python</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>


  
  
  <a id="release" href="#release"><h2>release</h2></a>
  
  

<div class="hentry" id="/2012/05/31/Forcing_Compiler_Nothing_checks">
  <h2 class="entry-title">
    <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/">Forcing Scala Compiler 'Nothing' Checks</a>
  </h2>
  
  <abbr class="published" title="2012-05-31T00:00:00-04:00">31 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Since early in its history, Casbah has had a helper method called <code>getAs[T]</code>, where <code>T</code> is "Some type you'd like to fetch a particular field as". Because of type erasure on the JVM, working with a Mongo Document can be annoying -- the representation in Scala is the equivalent of a <code>Map[String, Any]</code>. If we were to work with the <code>Map[String, Any]</code> in a standard mode, fetching a field <em>balance</em> which is a <code>Double</code> would require manual casting.</p>

<div class="highlight"><pre><code class="scala"><span class="k">val</span> <span class="n">doc</span><span class="k">:</span> <span class="kt">DBObject</span> <span class="o">=</span> <span class="nc">MongoDBObject</span><span class="o">(</span><span class="s">&quot;foo&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;bar&quot;</span><span class="o">,</span> <span class="s">&quot;balance&quot;</span> <span class="o">-&gt;</span> <span class="mf">2.5</span><span class="o">)</span>

<span class="k">val</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;balance&quot;</span><span class="o">)</span> 
</code></pre>
</div>


<p>We have already hit another issue here -- in Scala, invoking <code>get</code> on a <code>Map</code> returns <code>Option[T]</code> (Where, in this case, <code>T</code> is of type <code>Any</code>). Which means casting has become more complex: to get a <code>Double</code> we also have to unwrap the <code>Option[Any]</code> first. A lazy man's approach might be something hairy like so:</p>

<div class="highlight"><pre><code class="scala"><span class="n">balance</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="kc">null</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</code></pre>
</div>


<p>In the annals of history (when men were <em>real</em> men, and small furry creatures from Alpha Centauri were <em>real</em> small furry creatures from Alpha Centauri), the above became an annoyingly common pattern. A solution was needed - and so <code>getAs[T]</code> was born. The idea was not only to allow a shortcut to casting, but take care of the <code>Option[T]</code> wrapping for you as well. Invoking <code>getAs[Double]</code> will, in this case, return us an <code>Option[Double]</code>.</p>

<p>But not everything is perfect in the land of <code>getAs[T]</code> -- if the type requested doesn't match the actual type, runtime failures occur. Worse, if the user fails to pass a type, the Scala compiler substitutes <code>Nothing</code>, which <em>guarantees</em> a runtime failure. Runtime failures are bad -- but fortunately, <a href="http://twitter.com/milessabin">Miles Sabin</a> &amp; <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a> came up with an awesome solution.</p>

 
        <p> <a href="/2012/05/31/Forcing_Compiler_Nothing_checks/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/31/Forcing_Compiler_Nothing_checks/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3.0-RC1 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I published the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>



    </div>

    <div id="sidebar">
      <!-- sidebar components -->
      <div class="sidebar-node">
          <h3 class='sidebar-title'>Blogroll</h3>
          <div class='static-body'>
            <ul>
              <li><a href="http://blog.10gen.com/" title="10gen Blog">The 10Gen Blog on MongoDB and NoSQL</a></li>
              <li><a href="http://snailinaturtleneck.com/blog/" title="Snail In A Turtleneck">Snail In a Turtleneck - Kristina Chodorow (Maintainer of PHP &amp; Perl for MongoDB)</a></li>
              <li><a href="http://kylebanker.com/blog/" title="Hwaet!">Hwaet! - Kyle Banker (Maintainer of Ruby for MongoDB)</a></li>
              <li><a href="http://worldairmaillinks.com" title="World Airmail Links">World Airmail Links</a></li>
            </ul>
         </div>
        <h3 class='sidebar-title'>Projects &amp; Sites I've Worked On</h3>
        <div class='static-body'>
          <ul>
            <li><a href="http://github.com/bwmcadams/" title="GitHub">GitHub Profile</a></li>
            <li><a href="http://mongodb.org/" title="MongoDB">MongoDB</a> 
            <div class="sidebar_tiny">I work fulltime on MongoDB at <a href="http://10gen.com">10gen</a>, maintaining JVM tools such as the <a href="http://github.com/mongodb/mongo-java-driver">Java Driver</a>, <a href="http://github.com/mongodb/casbah">Casbah (Scala Driver)</a> and <a href="http://github.com/mongodb/mongo-hadoop">Hadoop Integration</a>.</div> 
            </li>
            <li><a href="http://api.mongodb.org/scala/casbah/latest/" title="Casbah">Casbah</a> <div class="sidebar_tiny">An open source Scala driver for MongoDB that I created &amp; maintain.</div></li>
            <li><a href="http://sluggy.com/" title="Sluggy Freelance">Sluggy Freelance</a> <div class="sidebar_tiny">(I wrote &amp; maintain the current code running the site. [Python+Pylons+MongoDB])</div></li>
            <li><a href="http://userfriendly.org/" title="UserFriendly">UserFriendly</a> <div class="sidebar_tiny">(Once upon a time I built the CMS which runs their site. [Perl+mod_perl])</div></li>
            <li><a href="http://bitbucket.org/namlook/mongokit/">MongoKit</a> <div class="sidebar_tiny">(I've contributed Pylons support and a few other useful hacks.)</div></li>
          </ul>
        </div>
       
        <h3 class='sidebar-title'>Presentations</h3>
          <div class='static-body'>
            <ul>
                <li>
                    <a href="http://www.10gen.com/video/mongosv2010/coolfeatures">MongoDB Cool Features @ MongoSV 12/10</a>
                </li>
                <li>
                    <a href="http://www.10gen.com/video/mongosv2010/hadoop">The Hadoop Plugin for MongoDB @ MongoSV 12/10</a> 
                </li>
                <li>
                    <a href="http://www.10gen.com/video/mongodc2010/schemadesign">Schema Design with MongoDB @ MongoDC 11/10</a>
                </li>
                <li>
                    MongoDB + Scala @ NY Scala 8/10
                    <ul>
                      <li>
                        <a href="http://www.slideshare.net/bwmcadams/scalany-mongodb-aug10">Slides</a>
                      </li>
                      <li>
                        <a href="http://vimeo.com/14090025">Video</a>
                      </li>
                    </ul>
                </li>
                <li>
                    Migrating Sluggy.com from MySQL to MongoDB @ Mongo NY 5/10
                    <ul>
                      <li>
                        <a href="http://www.scribd.com/doc/31748635/From-MySQL-to-MongoDB-at-Sluggy-com">Slides</a> 
                      </li>
                      <li>
                        <a href="http://blip.tv/file/3704023">Video</a>
                        </li>
                     </ul>
                </li>
           </ul>

          </div>
        
        <h3 class='sidebar-title'>Twitter</h3>
          <div class='static-body' id='twitter_block'>
            <div id="twitter_div">
                <script src="http://widgets.twimg.com/j/2/widget.js"></script>
                <script>
                new TWTR.Widget({
                  version: 2,
                  type: 'profile',
                  rpp: 4,
                  interval: 6000,
                  width: 'auto',
                  height: 300,
                  theme: {
                    shell: {
                      background: '#333333',
                      color: '#ffffff'
                    },
                    tweets: {
                      background: '#000000',
                      color: '#ffffff',
                      links: '#4aed05'
                    }
                  },
                  features: {
                    scrollbar: false,
                    loop: false,
                    live: true,
                    hashtags: true,
                    timestamp: true,
                    avatars: true,
                    behavior: 'all'
                  }
                }).render().setUser('rit').start();
                </script>
          </div>
        </div>
        <h3>Syndicate</h3>
        <ul>
            <li><a href="/atom.xml" title="Articles feed">Articles</a></li>
        </ul>

    <br style="clear:both;" />
  </div>
  </div>
  <div id="footer">
    <hr />
    <p><a href="/">Evil Monkey Labs</a></p>
    <ul>
      <li>made with <a href="http://github.com/vilcans/scribbish-jekyll">scribbish-jekyll</a></li>
    </ul>
    <div id="copyright">
      Copyright &copy; 2009-2011 Brendan W. McAdams.<br>
      <span id="disclaimer">
        Views expressed herein are my own. They in no way reflect the views or opinions of my employer (past, current or future), affiliated projects, publisher, or, in many cases, a sane or rational individual.
      </span>
    </div>
  </div>
</div>
<script type="text/javascript">
var disqus_shortname = 'evilmonkeyblog';
(function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/evilmonkeyblog/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

</body>
</html>
