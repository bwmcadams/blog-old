<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Evil Monkey Labs</title>
  
  
  <link href="http://blog.evilmonkeylabs.com" rel="alternate" title="Evil Monkey Labs" type="application/atom+xml" />
  <link rel="openid.delegate" href="http://evilmonkeylabs.myopenid.com" />

  <link rel="stylesheet" href="/stylesheets/application.css" type="text/css" />
  <link rel="stylesheet" href="/stylesheets/evilmonkey.css" type="text/css" />
</head>

<body>
<div id="container">
  <div id="logo">
    <img src="/images/logo_small.png" alt="Evil Monkey Logo"/>
  </div>
  <div id="header">
    <h1><span><a href="/">Evil Monkey Labs</a></span></h1>
    <h2>Code and related ramblings.</h2>
  </div>

  <div id="page">
    <div id="content">
      <div id="home">
  <h1>Blog Posts</h1>
  
  

<div class="hentry" id="/2012/05/29/Casbah2.3_Released">
  <h2 class="entry-title">
    <a href="/2012/05/29/Casbah2.3_Released/">Casbah 2.3 Released</a>
  </h2>
  
  <abbr class="published" title="2012-05-29T00:00:00-04:00">29 May 2012</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Today, I released the first Release Candidate of Casbah 2.3.0, available for SBT users as  <code>"org.mongodb" % "casbah" % "2.3.0-RC1"</code>. My <a href="http://notes.implicit.ly/post/24009446396/casbah-2-3-0rc1">release announcement</a> to <a href="http://implicit.ly">implicit.ly</a> contains the details on all of the bugs fixed – I will also be posting another set of blog entries shortly outlining the specific improvements to the code and demoing fetaures.</p>

<p>It has been just about a year since the last major release of Casbah, which was version <strong>2.1.5-1</strong>.  A number of factors led to the delay in getting a major update out the door, for which I apologize.  Amongst other things I have spent much of the last year since Casbah's prior release on the road doing training, consulting and evangelization of MongoDB to users around the globe; I had less time for code among all these things than I expected!  Additionally, after releasing the <strong>2.1.x</strong> series of Casbah I embarked on what quickly morphed from Casbah <strong>2.2.0</strong> to <strong>3.0.0</strong> – a major refactoring and cleanup of 2+ years of API cruft and "I'm Gonna Learn Me Some Scala!" detritus.  In all the excitement to release a perfect release to end all releases, I did a poor job of making it easy to backport and maintain a compatibility series for <strong>2.x</strong> users – a harsh lesson in the importance of creating small, bite sized git commits that can be cherry picked.</p>

<h2>So What Happened to Casbah 3.0? And 2.2?</h2>

<p>Casbah <strong>2.2.x</strong> is dead – <strong>3.0.x</strong> is certainly not!  When the work following <strong>2.1.x</strong> was begun, I had published a number of early snapshots as Casbah <em>2.2.0-SNAPSHOT</em>.  During this development cycle I found a lot of the aforementioned detritus such as overloaded methods (Casbah was begun as a Scala 2.7.x project and I never fully moved its core APIs over to use named and default arguments - some of these are corrected in Casbah <strong>2.3.0</strong> but in the interest of backwards compatibility with prior releases of 2.x, not completely). As I worked on coding improvements around these things the API drifted further and further away from compatibility and I chose to kill off the <strong>2.2.x</strong> series, planning the next release of Casbah as <strong>3.0.0</strong>.  In addition to that, I intended Casbah <strong>3.0.0</strong> to coincide with MongoDB <strong>2.2.0</strong> which will have additional features such as the New Aggregation Framework.  As MongoDB 2.2 hasn't been released yet, it became clear I needed to provide an updated Casbah release with many of the improvements but without many of the API breakages introduced in <strong>3.0</strong> - including a vastly improved build of the Casbah Query DSL which has stronger type safety and compiler checks thanks to the inimitable <a href="http://twitter.com/jteigen">Jon-Anders Teigen</a>.</p>

<p>Casbah <strong>3.0</strong> is still very much alive and in development, with <strong>2.3.0</strong> representing a backporting of many of the changes and improvements from <strong>3.0</strong>.  Because of the abandonment of the original <strong>2.2</strong> development series, I felt it was saner to kill <strong>2.2.x</strong> dead and bring the backports into a <strong>2.3.x</strong> series. You can, if you wish, think of this as <em>Casbah 2.3 - The Search for Casbah 2.2</em> (The long rumored sequel to Spaceballs has been said to be called <em>Spaceballs 3: The Search for Spaceballs 2</em>).</p>

<p>I will continue to support and improve Casbah <strong>2.3.x</strong> moving forward as well as completing Casbah <strong>3.0</strong> (still intended to coincide with the release of MongoDB 2.2). If you have any questions, please don't hesitate to contact me!</p>

<p><em>Later tonight or tomorrow I will post an entry or two detailing all of the wonderful changes in Casbah 2.3.0 and how to take advantage of them.</em></p>

    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#casbah">casbah</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#release">release</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2012/05/29/Casbah2.3_Released/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/08/05/ScalaPythonJavaCaptureBlockResult">
  <h2 class="entry-title">
    <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/">Immutability and Clever Variable Usage in the Land of Blocks and Branches</a>
  </h2>
  
  <abbr class="published" title="2011-08-05T00:00:00-04:00">05 Aug 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>Last night, I found myself unconciously refactoring some Scala code (I don't recall if it was something I wrote or someone else did at this point). As I looked at what I was doing I realized that many Scala developers don't seem entirely aware of one of my favorite features.  What I'm talking about is effectively capturing values from multibranch block statements in Scala.  Used correctly they can greatly decruft complicated code as well as helping us use mutability in places we might not expect an easy way to do so.</p>

<p>In typical C-like languages (such as C, C++, and Java) we are restricted in our syntax should we wish to capture a value when running many branching blocks such as if-else statements, switch statements and even for/foreach constructs. When we find ourselves wanting to set the value of a variable within each possible condition or iteration, we need to declare a mutable variable before the block.  We then mutate this variable within each condition or iteration.  Take this example from Java:</p>

<div class="highlight"><pre><code class="java"><span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;VALIDATED&quot;</span><span class="o">;</span>
<span class="o">}</span> 
<span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">&quot;INVALID&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>




 
        <p> <a href="/2011/08/05/ScalaPythonJavaCaptureBlockResult/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#effectivescala">effectivescala</a> <a rel="tag" href="/tags/#bestpractices">bestpractices</a> <a rel="tag" href="/tags/#python">python</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/08/05/ScalaPythonJavaCaptureBlockResult/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>


<div class="hentry" id="/2011/07/13/User_Configgable_Type_Filtering_with_Type_Classes">
  <h2 class="entry-title">
    <a href="/2011/07/13/User_Configgable_Type_Filtering_with_Type_Classes/">User Configurable Type Filtering with Scala Type Classes</a>
  </h2>
  
  <abbr class="published" title="2011-07-13T00:00:00-04:00">13 Jul 2011</abbr>
  <br class="clear" />
  <div class="entry-content">
    
        <p>When I woke up this morning and looked through my twitter mentions, I found this gem sitting there from the middle of the night:</p>

<p><img src="/images/oid_lt_casbah.png" alt="@rit when using &quot;_id&quot; $lt new ObjectId(timestamp) it throws ValidDateOrNumericType, but we might want to select records after id timestamp (from @justthor)" /></p>

<p>The user in question is complaining that when using <a href="http://github.com/mongodb/casbah">Casbah's DSL</a>, it doesn't allow a MongoDB <code>ObjectId</code> as a valid type to the <code>$lt</code> operator.  But as <a href="http://twitter.com/justthor">@justthor</a> points out, it is entirely possible to use <code>ObjectId</code> with the <code>$lt</code> operator since it contains timestamp information (See the <a href="http://www.mongodb.org/display/DOCS/Object+IDs">documentation for ObjectId</a> if you want nitty gritty detail).   When I wrote the code for <code>$lt</code> however, I needed to decide what types were valid and weren't valid; I can't exactly guarantee type safety wih a DSL like Casbah's, but I can enforce type <em>sanity</em>.  Whether I forgot that you can use <code>ObjectId</code> in <code>$lt</code> or just decided that most people wouldn't need to is irrelevant --- I had in this case blocked a user from accomplishing something valid that they needed to.</p>

<p>It is a more than reasonable problem, and my initial reaction was "oh crap, I guess I need to patch that".  But what I forgot is that a few releases back, I rearchitected Casbah to obviate this kind of problem.  Casbah now allows for a user definable (or, if you prefer, "adjustable") type filter on any of its DSL operators.  This is accomplished through a very simple application of Scala Type Classes, a term which gets batted around a lot in the Scala community, but few seem able to understand or articulate its meaning to us lesser mortals.  Over the last few months I've come to understand Type Classes much more deeply than I think I ever expected, and applied these lessons to the design of my code.  As I failed to document the power and usage of these features at the time, I am going to be writing some additional detailed articles about <em>my</em> understanding of Type Classes in the next few weeks, and this is the first of such explanations.</p>

<p>So the question at hand is, how exactly does Casbah allow us to do this magical type filtering that I just mentioned, without patching the driver or creating a new release?  First, let's look at how Casbah used to do things before the introduction of the as-yet unexplained Type Class introduction.</p>

 
        <p> <a href="/2011/07/13/User_Configgable_Type_Filtering_with_Type_Classes/#more" class="more-link"><span class="readmore">Read the rest of this entry  »</span></a></p>
    
  </div>
  <ul class="meta">
    
    
      <li>Tags: <a rel="tag" href="/tags/#tech">tech</a> <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#scala">scala</a> <a rel="tag" href="/tags/#mongodb">mongodb</a> <a rel="tag" href="/tags/#typeclasses">typeclasses</a> <a rel="tag" href="/tags/#stupidpettricks">stupidpettricks</a></li>
    
    <li>Meta:
      <a href="http://blog.evilmonkeylabs.com/2011/07/13/User_Configgable_Type_Filtering_with_Type_Classes/#disqus_thread" rel="bookmark">permalink</a>
      <a href="http://blog.evilmonkeylabs.com">atom</a>
    </li>
  </ul>
  <div class="posts">
    
    <span align="left">&laquo; <a href="/page2/">Older Posts</a></span>
    
    
  </div>
</div>

</ul>

</div>

    </div>

    <div id="sidebar">
      <!-- sidebar components -->
      <div class="sidebar-node">
          <h3 class='sidebar-title'>Blogroll</h3>
          <div class='static-body'>
            <ul>
              <li><a href="http://blog.10gen.com/" title="10gen Blog">The 10Gen Blog on MongoDB and NoSQL</a></li>
              <li><a href="http://snailinaturtleneck.com/blog/" title="Snail In A Turtleneck">Snail In a Turtleneck - Kristina Chodorow (Maintainer of PHP &amp; Perl for MongoDB)</a></li>
              <li><a href="http://kylebanker.com/blog/" title="Hwaet!">Hwaet! - Kyle Banker (Maintainer of Ruby for MongoDB)</a></li>
              <li><a href="http://worldairmaillinks.com" title="World Airmail Links">World Airmail Links</a></li>
            </ul>
         </div>
        <h3 class='sidebar-title'>Projects &amp; Sites I've Worked On</h3>
        <div class='static-body'>
          <ul>
            <li><a href="http://github.com/bwmcadams/" title="GitHub">GitHub Profile</a></li>
            <li><a href="http://mongodb.org/" title="MongoDB">MongoDB</a> 
            <div class="sidebar_tiny">I work fulltime on MongoDB at <a href="http://10gen.com">10gen</a>, maintaining JVM tools such as the <a href="http://github.com/mongodb/mongo-java-driver">Java Driver</a>, <a href="http://github.com/mongodb/casbah">Casbah (Scala Driver)</a> and <a href="http://github.com/mongodb/mongo-hadoop">Hadoop Integration</a>.</div> 
            </li>
            <li><a href="http://api.mongodb.org/scala/casbah/latest/" title="Casbah">Casbah</a> <div class="sidebar_tiny">An open source Scala driver for MongoDB that I created &amp; maintain.</div></li>
            <li><a href="http://sluggy.com/" title="Sluggy Freelance">Sluggy Freelance</a> <div class="sidebar_tiny">(I wrote &amp; maintain the current code running the site. [Python+Pylons+MongoDB])</div></li>
            <li><a href="http://userfriendly.org/" title="UserFriendly">UserFriendly</a> <div class="sidebar_tiny">(Once upon a time I built the CMS which runs their site. [Perl+mod_perl])</div></li>
            <li><a href="http://bitbucket.org/namlook/mongokit/">MongoKit</a> <div class="sidebar_tiny">(I've contributed Pylons support and a few other useful hacks.)</div></li>
          </ul>
        </div>
       
        <h3 class='sidebar-title'>Presentations</h3>
          <div class='static-body'>
            <ul>
                <li>
                    <a href="http://www.10gen.com/video/mongosv2010/coolfeatures">MongoDB Cool Features @ MongoSV 12/10</a>
                </li>
                <li>
                    <a href="http://www.10gen.com/video/mongosv2010/hadoop">The Hadoop Plugin for MongoDB @ MongoSV 12/10</a> 
                </li>
                <li>
                    <a href="http://www.10gen.com/video/mongodc2010/schemadesign">Schema Design with MongoDB @ MongoDC 11/10</a>
                </li>
                <li>
                    MongoDB + Scala @ NY Scala 8/10
                    <ul>
                      <li>
                        <a href="http://www.slideshare.net/bwmcadams/scalany-mongodb-aug10">Slides</a>
                      </li>
                      <li>
                        <a href="http://vimeo.com/14090025">Video</a>
                      </li>
                    </ul>
                </li>
                <li>
                    Migrating Sluggy.com from MySQL to MongoDB @ Mongo NY 5/10
                    <ul>
                      <li>
                        <a href="http://www.scribd.com/doc/31748635/From-MySQL-to-MongoDB-at-Sluggy-com">Slides</a> 
                      </li>
                      <li>
                        <a href="http://blip.tv/file/3704023">Video</a>
                        </li>
                     </ul>
                </li>
           </ul>

          </div>
        
        <h3 class='sidebar-title'>Twitter</h3>
          <div class='static-body' id='twitter_block'>
            <div id="twitter_div">
                <script src="http://widgets.twimg.com/j/2/widget.js"></script>
                <script>
                new TWTR.Widget({
                  version: 2,
                  type: 'profile',
                  rpp: 4,
                  interval: 6000,
                  width: 'auto',
                  height: 300,
                  theme: {
                    shell: {
                      background: '#333333',
                      color: '#ffffff'
                    },
                    tweets: {
                      background: '#000000',
                      color: '#ffffff',
                      links: '#4aed05'
                    }
                  },
                  features: {
                    scrollbar: false,
                    loop: false,
                    live: true,
                    hashtags: true,
                    timestamp: true,
                    avatars: true,
                    behavior: 'all'
                  }
                }).render().setUser('rit').start();
                </script>
          </div>
        </div>
        <h3>Syndicate</h3>
        <ul>
            <li><a href="/atom.xml" title="Articles feed">Articles</a></li>
        </ul>

    <br style="clear:both;" />
  </div>
  </div>
  <div id="footer">
    <hr />
    <p><a href="/">Evil Monkey Labs</a></p>
    <ul>
      <li>made with <a href="http://github.com/vilcans/scribbish-jekyll">scribbish-jekyll</a></li>
    </ul>
    <div id="copyright">
      Copyright &copy; 2009-2011 Brendan W. McAdams.<br>
      <span id="disclaimer">
        Views expressed herein are my own. They in no way reflect the views or opinions of my employer (past, current or future), affiliated projects, publisher, or, in many cases, a sane or rational individual.
      </span>
    </div>
  </div>
</div>
<script type="text/javascript">
var disqus_shortname = 'evilmonkeyblog';
(function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/evilmonkeyblog/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

</body>
</html>
